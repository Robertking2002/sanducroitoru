<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sandu Croitoru's Sanctuary</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
:root {
    --bg-color: #0b1021; 
    --text-color: #2c2c2c;
    --text-light: #fdfdfd;
    --accent-color: #8e7f66;
    --border-color: #e1e8ed;
}

* { box-sizing: border-box; }

body, html {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    scroll-behavior: smooth;
    min-height: 100vh;
    overflow-x: hidden;
}

h1, h2, .nav-btn, .user-label, .section-header {
    font-family: 'Playfair Display', serif;
}

/* --- LOGO --- */
.logo-link {
    position: fixed;
    top: 15px;
    left: 25px;
    z-index: 1100;
    transition: all 0.3s ease;
}
.logo-link:hover { opacity: 0.7; }
.logo-img {  
  height: 30px;
  width: 180px;
 }

/* --- HEADER & NAVIGATION --- */
header {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(11, 16, 33, 0.85); 
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 1000;
    display: flex;
    justify-content: center;
    padding: 15px 0;
    transition: all 0.2s ease;
}

nav { 
    display: flex; 
    align-items: center; 
    justify-content: center;
    flex-wrap: nowrap; /* Prevents jumping to new lines */
    width: 90%;
    max-width: 1200px;
}

nav button.nav-btn {
    background: none;
    border: none;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin: 0 10px;
    cursor: pointer;
    color: var(--text-light); 
    padding: 5px 0;
    transition: color 0.3s;
    white-space: nowrap;
}

nav button.nav-btn:hover { color: var(--accent-color); }
nav button.nav-btn.active {
    color: var(--accent-color);
    border-bottom: 2px solid var(--accent-color);
}

/* --- STATIC LANGUAGE BUTTONS --- */
.lang-container {
    display: flex;
    gap: 8px;
    margin-left: 20px;
    padding-left: 15px;
    border-left: 1px solid rgba(255,255,255,0.2);
}

.lang-btn-static {
    background: none;
    border: 2px solid transparent;
    cursor: pointer;
    padding: 2px;
    border-radius: 4px;
    transition: transform 0.2s, border-color 0.2s;
    display: flex;
}

.lang-btn-static:hover { transform: scale(1.1); }
.lang-btn-static.active { border-color: var(--accent-color); }

.flag-icon { width: 28px; height: 18px; object-fit: cover; border-radius: 2px; }

/* --- HERO SECTION --- */
.hero-section {
    height: 65vh;
    transition: background-image 1.2s ease-in-out;
    background-size: cover;
    background-position: center; 
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
    position: relative;
    padding: 0 20px;
}

.hero-section h1 {
    font-size: clamp(1.8rem, 6vw, 3.5rem); 
    text-shadow: 2px 2px 15px rgba(0,0,0,0.9);
    margin: 0;
}



@media (max-width: 1059px) {
    header { padding-top: 60px; } /* Space for logo when it centers */
    .logo-link { left: 50%; transform: translateX(-50%); }
    nav { flex-wrap: wrap; justify-content: center; }
}

@media (max-width: 1024px) {
    .logo-img { height: 40px; }
    nav button.nav-btn {
        font-size: 0.75rem;
        margin: 5px 8px;
    }
}

/* --- CONTENT --- */
.main-content { padding-top: 100px; }
.tab-content { display: none; min-height: calc(100vh - 80px); animation: fadeIn 0.6s ease; }
.tab-content.active { display: block; }

.book-desc-container {
    max-width: 750px; 
    margin: 30px auto; 
    text-align: justify; 
    line-height: 1.8; 
    font-size: 1.05rem;
    padding: 30px;
    color: #f0f0f0; 
    background: rgba(0, 0, 0, 0.6); 
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.post-container {
    width: 90%;
    max-width: 900px;
    margin: -50px auto 50px;
    background: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    position: relative;
    z-index: 10;
}

#admin-editor-zone { display: none; margin-bottom: 40px; border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; }

textarea#postInput { 
    width: 100%; height: 120px; border: 1px solid #eee; 
    font-size: 1.2rem; padding: 15px; border-radius: 8px; 
    outline: none; font-family: inherit; 
}

.feed-item { border-bottom: 1px solid #f0f0f0; padding: 25px 0; position: relative; }
.user-label { font-weight: 700; font-size: 1.2rem; color: var(--text-color); }
.timestamp { color: #888; font-size: 0.8rem; display: block; margin-bottom: 10px; }

.admin-buttons { margin-top: 15px; display: none; }
.admin-buttons button { margin-right: 10px; padding: 5px 15px; border: none; border-radius: 4px; cursor: pointer; }
.delete-btn { background-color: #ff4444; color: white; }
.edit-btn { background-color: #4CAF50; color: white; }

/* BOOKS - Starry Background */
#book1, #book2 {
    background-image: url('Stars.jpg');
    background-attachment: fixed;
    background-size: cover;
    background-position: center;
}

.book-wrapper {
    padding: 100px 20px 80px;
    display: flex; gap: 40px; justify-content: center; flex-wrap: wrap; text-align: center;
    color: white;
}

.book-img {
    width: 280px; height: 420px; object-fit: cover; border-radius: 8px; 
    cursor: pointer; box-shadow: 0 15px 35px rgba(0,0,0,0.6);
    transition: transform 0.4s ease;
}
.book-img:hover { transform: scale(1.02); }

.download-btn {
    margin-top: 30px; padding: 15px 40px; background: var(--accent-color);
    color: white; text-decoration: none; font-weight: bold; border-radius: 4px; display: inline-block;
}

.site-footer { 
    background: #000000; color: white; padding: 60px 20px; text-align: center; position: relative;
}

.ghost-login-area { 
    position: absolute; bottom: 10px; right: 10px; width: 20px; height: 20px; z-index: 2000; cursor: pointer;
}

.login-overlay { 
    position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 99999; 
}

.login-box { background: white; padding: 40px; border-radius: 16px; text-align: center; width: 90%; max-width: 350px; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.translate-toggle { 
    background: none; border: none; font-size: 0.85rem; font-weight: 600; 
    cursor: pointer; color: var(--accent-color); margin-top: 10px; padding: 5px 0;
}

.translated-content { 
    margin-top: 10px; padding: 15px; background: #f9f9f9; border-left: 3px solid var(--accent-color); 
    font-style: italic; display: none; border-radius: 0 8px 8px 0;
}

.post-content { margin-top: 10px; line-height: 1.6; font-size: 1.05rem; }

.loading {
    display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f3f3;
    border-top: 2px solid var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.cache-indicator { font-size: 0.75rem; color: #28a745; margin-top: 5px; font-weight: bold; }
</style>
</head>

<body>

<audio id="myAudio" loop playsinline>
  <source src="background.mp3" type="audio/mpeg">
</audio>

<script>
  function startGlobalAudio() {
    const audio = document.getElementById('myAudio');
    if (audio) {
      audio.volume = 0.2; 
      console.log("Attempting to play audio...");
      audio.play()
        .then(() => console.log("Audio playing successfully!"))
        .catch((err) => console.log("Playback failed: ", err));
    }
  }

  ['click', 'touchstart', 'mousedown'].forEach(eventType => {
    document.addEventListener(eventType, startGlobalAudio, { once: true });
  });
</script>

<a class="logo-link" href="https://robertking2002.github.io/sanducroitoru/" target="_blank">
    <img src="Logo.png" class="logo-img" alt="Logo">
</a>

<div id="login-modal" class="login-overlay">
    <div class="login-box">
        <h2 id="login-title">Admin Access</h2>
        <input type="text" id="login-username" placeholder="Username" style="width:100%; padding:10px; margin-bottom:10px;">
        <input type="password" id="login-password" placeholder="Password" style="width:100%; padding:10px; margin-bottom:10px;">
        <div style="display:flex; gap:10px;">
            <button onclick="attemptLogin()" style="flex:1; padding:10px; background:var(--accent-color); color:white; border:none;">Login</button>
            <button onclick="closeLogin()" style="flex:1; padding:10px; background:#eee; border:none;">Cancel</button>
        </div>
    </div>
</div>

<header id="site-header">
    <nav>
        <button class="nav-btn active" onclick="showTab('home',this)" id="nav-home">Home</button>
        <button class="nav-btn" onclick="showTab('book1',this)" id="nav-book1">Faith Diagnosis - RO</button>
        <button class="nav-btn" onclick="showTab('book2',this)" id="nav-book2">Faith Diagnosis - GR</button>
        
        <div class="lang-container">
            <button class="lang-btn-static active" onclick="setLanguage('en')" id="btn-en">
                <img src="https://flagcdn.com/w40/gb.png" class="flag-icon">
            </button>
            <button class="lang-btn-static" onclick="setLanguage('ro')" id="btn-ro">
                <img src="https://flagcdn.com/w40/ro.png" class="flag-icon">
            </button>
            <button class="lang-btn-static" onclick="setLanguage('gr')" id="btn-gr">
                <img src="https://flagcdn.com/w40/gr.png" class="flag-icon">
            </button>
        </div>
    </nav>
</header>

<div class="main-content">
    <div id="home" class="tab-content active">
        <div class="hero-section" id="hero-slideshow">
            <h1 id="hero-title">Sandu Croitoru's Sanctuary</h1>
        </div>
        
        <div class="post-container">
            <div id="admin-editor-zone">
                <span class="user-label">Sandu Croitoru</span>
                <textarea id="postInput" placeholder="Împărtășește-ți gândurile..."></textarea>
                <div style="text-align:right; margin-top:10px;">
                    <button onclick="submitPost()" id="post-button" style="padding:10px 30px; background:var(--accent-color); color:white; border:none; border-radius:20px; cursor:pointer;">Post</button>
                    <span id="post-status" style="margin-left: 10px; font-size: 0.9rem; color: #666;"></span>
                </div>
            </div>
            
            <h2 id="latest-updates">Author's Thoughts</h2>
            <div id="feed"></div>
        </div>
        
        <footer class="site-footer">
            <p>© 2026 Sandu Croitoru. All rights reserved.</p>
            <div class="ghost-login-area" onclick="handleGhostClick()"></div>
        </footer>
    </div>

    <div id="book1" class="tab-content">
        <div class="book-wrapper">
            <div class="book-item">
                <img src="Cover1.jpg" id="img-b1" class="book-img" onclick="toggleCover('img-b1', 'Cover1.jpg', 'Cover3.jpg')">
                <h2 id="book1-title" style="margin-top: 30px; margin-bottom: 10px;">Faith Diagnosis - RO</h2>
                <div class="book-desc-container">
                    <p id="book1-desc-p1">Faith is the algorithm of those who cannot perceive and deepen the truth through knowing and living it, and sums up only the aprioric uncertainty of the credal illusion of what the truth symbolizes or embodies. It is one thing for Jesus to become an accepted truth for you through your faith in Him and another to merge with the truth of Jesus from the perspective of the transhumance of the merging of one's own being through knowing Him. It is one thing to believe in the truth and another to transcend the truth by becoming an integral part of it through the Christ equation of the spiritual quantum metamorphosis of the being in the vibration of the phrase: "I am the truth!""</p>
                    <p id="book1-desc-p2">You cannot live, feel or know God through faith. Faith is the prerogative of ignorance. Praying to the one you do not know... the truth is not revealed to you through faith in Him but through knowing Him, and you continue to pray to the one you do not know. Do not expect the revelation of the truth through faith, at most the discovery of your own self, and that only if the faith you have, you have for yourself. Accepting a group faith transforms you into a spiritual semi-learned person; refusing group faith and aligning yourself with your own faith transforms you gradually into a learned person of semi-acquired truths. You were told that if you have faith as small as a mustard seed you will move mountains. Well you have it, so how many mountains have you moved with it? I do not ask you to move mountains, but put that mustard seed in front of you and through the faith you have: Move it! If it hasn't moved then you have a major problem with your own faith. The solution? Fulfillment. Jesus came to fulfill the Law, you fulfill your faith through knowledge, otherwise the Kingdom of Heaven will remain an unknown and untouched nimbus both literally and figuratively.</p>
                </div>
                <a href="Diagnoza_Credintei.pdf" target="_blank" class="download-btn" id="book1-btn">VIEW BOOK</a>
            </div>
        </div>
        <footer class="site-footer"><h2 id="comm-footer-1">Communication</h2><p>sandusilvia.croitoru@gmail.com</p></footer>
    </div>

    <div id="book2" class="tab-content">
        <div class="book-wrapper">
            <div class="book-item">
                <img src="Cover2.jpg" id="img-b2" class="book-img" onclick="toggleCover('img-b2', 'Cover2.jpg', 'Cover4.jpg')">
                <h2 id="book2-title" style="margin-top: 30px; margin-bottom: 10px;">Faith Diagnosis - GR</h2>
            
                <div class="book-desc-container">
                    <p id="book2-desc">Coming Soon!</p>
                </div>
                <a href="#" target="_blank" class="download-btn" id="book2-btn" style="display:none;">BOOK</a>
            </div>
        </div>
        <footer class="site-footer"><h2 id="comm-footer-2">Communication</h2><p>sandusilvia.croitoru@gmail.com</p></footer>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, updateDoc, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBCwpfHmLZjDV5l2W-TKnN57K2ZqP5jg0c",
  authDomain: "sandu-croitoru.firebaseapp.com",
  projectId: "sandu-croitoru",
  storageBucket: "sandu-croitoru.firebasestorage.app",
  messagingSenderId: "998140149044",
  appId: "1:998140149044:web:8b1665b17fd320d44df961",
  measurementId: "G-VKQ3JVG7V2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentLang = 'en';
let adminMode = false;
let editingPostId = null;

const translations = {
    en: { 
        "nav-home": "Home", "nav-book1": "Faith Diagnosis - RO", "nav-book2": "Faith Diagnosis - GR",
        "hero-title": "Sandu Croitoru's Sanctuary", "latest-updates": "Author's Thoughts", "post-button": "Post",
        "comm-footer-1": "Communication", "comm-footer-2": "Communication",
        "book1-title": "Diagnosis of Faith - RO", "book1-btn": "VIEW BOOK",
        "book1-desc-p1": "Faith is the algorithm of those who cannot perceive and deepen the truth through knowing and living it, and sums up only the aprioric uncertainty of the credal illusion of what the truth symbolizes or embodies. It is one thing for Jesus to become an accepted truth for you through your faith in Him and another to merge with the truth of Jesus from the perspective of the transhumance of the merging of one's own being through knowing Him. It is one thing to believe in the truth and another to transcend the truth by becoming an integral part of it through the Christ equation of the spiritual quantum metamorphosis of the being in the vibration of the phrase: 'I am the truth!'",
        "book1-desc-p2": "You cannot live, feel or know God through faith. Faith is the prerogative of ignorance. Praying to the one you do not know... the truth is not revealed to you through faith in Him but through knowing Him, and you continue to pray to the one you do not know. Do not expect the revelation of the truth through faith, at most the discovery of your own self, and that only if the faith you have, you have for yourself. Accepting a group faith transforms you into a spiritual semi-learned person; refusing group faith and aligning yourself with your own faith transforms you gradually into a learned person of semi-acquired truths. You were told that if you have faith as small as a mustard seed you will move mountains. Well you have it, so how many mountains have you moved with it? I do not ask you to move mountains, but put that mustard seed in front of you and through the faith you have: Move it! If it hasn't moved then you have a major problem with your own faith. The solution? Fulfillment. Jesus came to fulfill the Law, you fulfill your faith through knowledge, otherwise the Kingdom of Heaven will remain an unknown and untouched nimbus both literally and figuratively.","book2-title": "Faith Diagnosis - GR","book2-desc": "Coming Soon!","comm-footer-2": "Communication"
    },
    ro: { 
        "nav-home": "Acasă", "nav-book1": "Diagnoza Credinței - RO", "nav-book2": "Diagnoza Credinței - GR",
        "hero-title": "Sanctuarul lui Croitoru Sandu", "latest-updates": "Gândurile autorului", "post-button": "Postează",
        "comm-footer-1": "Comunicare", "comm-footer-2": "Comunicare",
        "book1-title": "Diagnoza Credinței - RO", "book1-btn": "VEZI CARTEA",
        "book1-desc-p1": "Credința este algoritmul celor ce nu pot percepe și aprofunda adevărul prin cunoașterea și trăirea acestuia și se rezumă doar la incertidudinea apriorică a iluziei crezuale a ceea ce adevărul simbolizează sau intruchipează. Una e să devină Iisus un adevăr acceptat pentru tine prin credința ta in El si alta e să fuzionezi cu adevărul lui Iisus din prisma transhumanței contopirii propriei ființe prin cunoașterea acestuia. Una e să crezi in adevăr și alta e să trancenzi adevărul devenind parte integrantă al acestuia prin ecuația hristică a metamorfozării cuanticii spirituale a ființei in vibrația frazei : 'Eu sunt adevărul!'",
        "book1-desc-p2": "Pe Dumnezeul nu-l poți trăi, simți sau cunoaște prin credință. Credința este apanajul necunoașterii. Rugându-te celui ce nu cunoști... adevărul nu ți se revelează prin credința in El ci prin cunoașterea acestuia iar tu continui să te rogi celui ce nu cunoști. Nu aștepta revelația adevărului prin credință, cel mult descoperirea propriului sine și asta doar dacă credința pe care o ai, o ai pentru tine însuți. Acceptând o credință de grup te transformi intr-un semidoct spiritual, refuzând credința de grup si aliniindu-te la credința proprie te transformi treptat intr-un doct al unor adevăruri seminsusite. Ți sa spus că dacă ai credință cât un bob de muștar vei muta munții. Ei bine o ai, atunci câți munți ai mutat cu ea? Eu nu îți cer să muți munții ci pune acel bob de muștar in fața ta și prin credința pe care o ai : Mută-l! Dacă nu sa mutat atunci ai o problemă majoră cu propria-ti credință. Soluția? Implinirea. Iisus a venit să împlinească Legea, tu implinește-ți credința prin cunoaștere, altfel Împărăția cerurilor va rămâne un nimb necunoscut și neatins atât la propriu cât și la figurat. ","book2-title": "Diagnoza Credinței - GR","book2-desc": "În curând!","comm-footer-2": "Comunicare"
    },
    gr: { 
        "nav-home": "Αρχικη", "nav-book1": "Η Διαγνωση της Πιστης - RO", "nav-book2": "Η Διαγνωση της Πιστης - GR",
        "hero-title": "Το Λιμάνι του Croitoru Sandu", "latest-updates": "Σκέψεις του συγγραφέα", "post-button": "Ανάρτηση",
        "comm-footer-1": "Επικοινωνία", "comm-footer-2": "Επικοινωνία",
        "book1-title": "Η Διάγνωση της Πίστης - RO", "book1-btn": "ΠΡΟΒΟΛΗ ΒΙΒΛΙΟΥ",
        "book1-desc-p1": "Η πίστη είναι ο αλγόριθμος εκείνων που δεν μπορούν να αντιληφθούν και να εμβαθύνουν στην αλήθεια μέσω της γνώσης και της εμπειρίας της και περιορίζεται μόνο στην εκ των προτέρων αβεβαιότητα της ψευδαίσθησης του τι συμβολίζει ή ενσαρκώνει η αλήθεια. Το ένα είναι να γίνει ο Ιησούς μια αποδεκτή αλήθεια για σένα μέσω της πίστης σου σε Αυτόν και το άλλο είναι να συγχωνευθείς με την αλήθεια του Ιησού από τη σκοπιά της μεταμόρφωσης της δικής σου ύπαρξης μέσω της γνώσης του. Άλλο είναι να πιστεύεις στην αλήθεια και άλλο να υπερβαίνεις την αλήθεια, γινόμενος αναπόσπαστο μέρος της μέσω της χριστιανικής εξίσωσης της μεταμόρφωσης της πνευματικής κβαντικής ύπαρξης στη δόνηση της φράσης: «Εγώ είμαι η αλήθεια!».",
        "book1-desc-p2": "Δεν μπορείς να ζήσεις, να νιώσεις ή να γνωρίσεις τον Θεό μέσω της πίστης. Η πίστη είναι το προνόμιο της άγνοιας. Προσευχόμενος σε αυτόν που δεν γνωρίζεις... η αλήθεια δεν σου αποκαλύπτεται μέσω της πίστης σε Αυτόν, αλλά μέσω της γνώσης Του, και εσύ συνεχίζεις να προσεύχεσαι σε αυτόν που δεν γνωρίζεις. Μην περιμένεις την αποκάλυψη της αλήθειας μέσω της πίστης, το πολύ την ανακάλυψη του εαυτού σου και αυτό μόνο αν η πίστη που έχεις, την έχεις για τον εαυτό σου. Αποδεχόμενος μια ομαδική πίστη μετατρέπεσαι σε έναν ημιμαθή πνευματικά, αρνούμενος την ομαδική πίστη και ευθυγραμμίζοντας τον εαυτό σου με την προσωπική σου πίστη μετατρέπεσαι σταδιακά σε έναν γνώστη ορισμένων αληθειών. Σου έχουν πει ότι αν έχεις πίστη όσο ένα σπυρί μουστάρδας, θα μετακινήσεις βουνά. Λοιπόν, την έχεις, πόσα βουνά έχεις μετακινήσει με αυτήν; Δεν σου ζητώ να μετακινήσεις βουνά, αλλά βάλε αυτό το σπυρί μουστάρδας μπροστά σου και με την πίστη που έχεις: Μετακίνησέ το! Αν δεν μετακινήθηκε, τότε έχεις ένα σοβαρό πρόβλημα με την πίστη σου. Η λύση; Η εκπλήρωση. Ο Ιησούς ήρθε για να εκπληρώσει τον Νόμο, εσύ εκπλήρωσε την πίστη σου μέσω της γνώσης, αλλιώς η Βασιλεία των Ουρανών θα παραμείνει ένα άγνωστο και απρόσιτο άσμα, τόσο κυριολεκτικά όσο και μεταφορικά.","book2-title": "Η Διάγνωση της Πίστης - GR","book2-desc": "Έρχεται σύντομα!","comm-footer-2": "Επικοινωνία"
    }
};

// --- CLOUD TRANSLATION LOGIC ---
window.handleTranslate = async function(id, encodedText) {
    const box = document.getElementById(`trans-${id}`);
    if(box.style.display === 'block') { box.style.display = 'none'; return; }
    
    box.innerHTML = '<span class="loading"></span> Connecting to cloud...';
    box.style.display = 'block';

    const originalText = decodeURIComponent(encodedText);
    const targetLang = currentLang === 'gr' ? 'el' : 'en';

    try {
        // 1. Check Cloud Cache (Firestore)
        const q = query(collection(db, "translations_cache"), 
                        where("original", "==", originalText), 
                        where("lang", "==", targetLang));
        const querySnapshot = await getDocs(q);
        
        if (!querySnapshot.empty) {
            const cachedData = querySnapshot.docs[0].data();
            box.innerHTML = `${cachedData.translated} <div class="cache-indicator">✓ Cloud Sync</div>`;
            return;
        }

        // 2. Call API (If not in cloud)
        const translation = await googleTranslate(originalText, 'ro', targetLang);

        if (translation && translation !== originalText) {
            await addDoc(collection(db, "translations_cache"), {
                original: originalText,
                translated: translation,
                lang: targetLang,
                timestamp: Date.now()
            });
            box.innerHTML = translation;
        } else {
            throw new Error("API Limit");
        }
    } catch (e) {
        const now = new Date();
        const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
        const diff = tomorrow - now;
        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        box.innerHTML = `<span style="color:#ff4444;">Sorry for the inconvenience, translation unavailable! Next translation available in ${h} hours ${m} minutes!</span>`;
    }
};

// Main API Translation
async function googleTranslate(text, sourceLang, targetLang) {
    try {
        const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceLang}|${targetLang}`);
        const data = await response.json();
        return data.responseData?.translatedText || text;
    } catch { return null; }
}

window.setLanguage = function(lang) {
    currentLang = lang;
    document.querySelectorAll('.lang-btn-static').forEach(b => b.classList.remove('active'));
    document.getElementById(`btn-${lang}`).classList.add('active');
    applyLang(lang);
};

function applyLang(lang) {
    const t = translations[lang];
    for (let key in t) {
        const el = document.getElementById(key);
        if (el) el.textContent = t[key];
    }
    renderFeed();
}

// --- REST OF FUNCTIONALITY ---
const slides = ['Background1.jpg', 'Background2.jpg', 'Background3.jpg'];
let slideIdx = 0;
function startSlideshow() {
    const hero = document.getElementById('hero-slideshow');
    hero.style.backgroundImage = `url('${slides[0]}')`;
    setInterval(() => {
        slideIdx = (slideIdx + 1) % slides.length;
        hero.style.backgroundImage = `url('${slides[slideIdx]}')`;
    }, 5000);
}

window.showTab = function(tabId, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    btn.classList.add('active');
    window.scrollTo(0,0);
    // Audio trigger on nav
    const audio = document.getElementById('myAudio');
    if(audio && audio.paused) { audio.volume = 0.3; audio.play().catch(()=>{}); }
};

window.toggleCover = (id, f, b) => {
    const img = document.getElementById(id);
    img.src = img.src.includes(f) ? b : f;
};

window.renderFeed = async function() {
    const feed = document.getElementById('feed');
    feed.innerHTML = '<p style="text-align:center;color:#888;">Loading...</p>';
    const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));
    const snap = await getDocs(q);
    feed.innerHTML = '';
    snap.forEach(d => {
        const p = d.data();
        const div = document.createElement('div');
        div.className = 'feed-item';
        div.innerHTML = `
            <span class="user-label">Sandu Croitoru</span>
            <span class="timestamp">${p.date}</span>
            <div class="post-content">${p.text}</div>
            <button class="translate-toggle" style="display:${currentLang==='ro'?'none':'block'}" 
                onclick="handleTranslate('${d.id}', '${encodeURIComponent(p.text)}')">Translate</button>
            <div class="translated-content" id="trans-${d.id}"></div>
            <div class="admin-buttons" style="display:${adminMode?'block':'none'}">
                <button class="delete-btn" onclick="deletePost('${d.id}')">Delete</button>
                <button class="edit-btn" onclick="editPost('${d.id}', '${encodeURIComponent(p.text)}')">Edit</button>
            </div>`;
        feed.appendChild(div);
    });
};

window.attemptLogin = () => {
    const u = document.getElementById('login-username').value;
    const p = document.getElementById('login-password').value;
    if(u === "admin" && p === "12345") {
        adminMode = true;
        document.getElementById('admin-editor-zone').style.display='block';
        closeLogin(); renderFeed();
    } else { closeLogin(); }
};

window.closeLogin = () => {
    document.getElementById('login-modal').style.display='none';
};

window.handleGhostClick = () => {
    if(adminMode) { adminMode=false; document.getElementById('admin-editor-zone').style.display='none'; renderFeed(); }
    else { document.getElementById('login-modal').style.display='flex'; }
};

window.submitPost = async () => {
    const val = document.getElementById('postInput').value;
    if(!val.trim()) return;
    if(editingPostId) {
        await updateDoc(doc(db, "posts", editingPostId), { text: val, timestamp: Date.now() });
        editingPostId = null;
    } else {
        await addDoc(collection(db, "posts"), { text: val, date: new Date().toLocaleString(), timestamp: Date.now() });
    }
    document.getElementById('postInput').value = '';
    renderFeed();
};

window.addEventListener('DOMContentLoaded', () => {
    startSlideshow();
    applyLang('en');
    renderFeed();
});
</script>
</body>
</html>


